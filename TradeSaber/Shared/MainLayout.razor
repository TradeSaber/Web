@inherits LayoutComponentBase

@inject IURLSettings urlSettings
@inject TradeSaberClient tradeSaberClient
@inject ILocalUserService localUserService
@inject NavigationManager navigationManager

<MudThemeProvider Theme="currentTheme" />
<MudSnackbarProvider />
<MudDialogProvider />

<MudLayout Class="pa-4">
    <MudAppBar Elevation="1">
        <MudLink Href="/">
            <img src="/images/logo-long-small.png" height="40" />
        </MudLink>
        <MudAppBarSpacer />
        @if (localUserService.ActiveUser is not null)
        {
            <MudAvatar Image="@localUserService.ActiveUser.Profile.AvatarURL()" @onclick="@(() => navigationManager.NavigateTo("/profile"))" Class="ma-2" Size="Size.Large" title="@localUserService.ActiveUser.Profile.Username" Style="cursor: pointer;" />
            <MudButtonGroup Color="Color.Primary" Variant="Variant.Filled">
                @if (localUserService.ActiveUser.Role?.Scopes.Contains("upload:file") ?? false)
                {
                    <MudButton OnClick=@(() => navigationManager.NavigateTo("/admin"))>Admin</MudButton>
                }
                <MudButton OnClick="LogOut">Log Out</MudButton>
            </MudButtonGroup>
        }
        else
        {
            <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="@(() => navigationManager.NavigateTo($"{urlSettings.API}/auth"))">Log In</MudButton>
        }
    </MudAppBar>
    <MudMainContent>
        <MudContainer>
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code { 

    protected override async Task OnInitializedAsync()
    {
        await localUserService.GetToken();
    }

    private async Task LogOut()
    {
        await localUserService.SetToken(null);
    }

    MudTheme currentTheme = new MudTheme
    {
        Palette = new Palette
        {
            Black = "#1b1b1c",
            Background = "#2e2e2e",
            BackgroundGrey = "#545454",
            Surface = "#3d3d3d",
            DrawerBackground = "#3d3d3d",
            DrawerText = "rgba(255,255,255, 0.50)",
            DrawerIcon = "rgba(255,255,255, 0.50)",
            AppbarBackground = "#c42929",
            AppbarText = "rgba(255,255,255, 0.70)",
            TextPrimary = "rgba(255,255,255, 0.70)",
            TextSecondary = "rgba(255,255,255, 0.50)",
            ActionDefault = "#b1adad",
            ActionDisabled = "rgba(255,255,255, 0.26)",
            ActionDisabledBackground = "rgba(255,255,255, 0.12)",
            Divider = "rgba(255,255,255, 0.12)",
            DividerLight = "rgba(255,255,255, 0.06)",
            TableLines = "rgba(255,255,255, 0.12)",
            LinesDefault = "rgba(255,255,255, 0.12)",
            LinesInputs = "rgba(255,255,255, 0.3)",
            TextDisabled = "rgba(255,255,255, 0.2)",

            Primary = "#ff8787",
            Secondary = "#4481C4"
        }
    };
}